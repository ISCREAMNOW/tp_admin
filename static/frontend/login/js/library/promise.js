define("library/promise",[],function(a,b,c){var d=function(a){function b(a,b){setTimeout(function(){for(;e.length;){var c=e.shift();if("function"==typeof c[a]){c[a](b)}}},1)}function c(a){b(0,a)}function d(a){b(1,a)}var e=[];a(c,d),this.then=function(a,b){return e.push([a,b]),this},this.chain=this.then,this["catch"]=function(a){return this.then(void 0,a)}};d.deferred=function(){var a=[];return a.promise=new d(function(b,c){a.resolve=b,a.reject=c}),a},d.resolve=d.cast=function(a){return new d(function(b){b(a)})},d.reject=function(a){return new d(function(b,c){c(a)})},d.all=function(a){function b(a,b){g[b]=a,f--,0==f&&e.resolve(g)}function c(a){e.reject(a)}var e=d.deferred(),f=a.length,g=[];return a.forEach(function(a,e){return a instanceof d?void a.then(function(a){b(a,e)},function(a){c(a)}):void b(a,e)}),e.promise},d.race=function(a){function b(a,b){f&&(e.resolve(a),f=!1)}function c(a){f&&(e.reject(a),f=!1)}var e=d.deferred(),f=!0;return a.forEach(function(a,e){return a instanceof d?void a.then(function(a){b(a,e)},function(a){c(a)}):void b(a,e)}),e.promise},d.fulfill=function(a){function b(a,b){g[b]=a,f--,0==f&&e.resolve(g)}function c(a){e.reject(a)}var e=d.deferred(),f=a.length,g=[];return a.forEach(function(a,e){return a instanceof d?void a.then(function(a){b(a,e)},function(a){c(a)}):void b(a,e)}),e.promise},c.exports=d});