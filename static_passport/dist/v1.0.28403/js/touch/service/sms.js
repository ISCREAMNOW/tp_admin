define("touch/service/sms",["library/q"],function(a){function b(a){a=$.extend({url:"/mobile/Login/ajax_send_sms_for_mobile_login",time:60,onCountStart:function(){},onCountStop:function(){}},a),this.url=a.url,this.state={smsTimesOver:!1,smsCounting:!1,smsSent:!1,smsSending:!1},this._setState=function(a,b){this.state[a]=b},this._getState=function(a){return this.state[a]},this.set=this._setState,this.get=this._getState,this.startCountDown=function(){function b(){return 0===c?void this.stopCountDown():(a.onCountDown(c),void(c-=1))}var c=a.time;a.onCountStart(),b(),this.set("timer",setInterval(b.bind(this),1e3)),this.set("smsCounting",!0)},this.stopCountDown=function(){clearInterval(this.get("timer")),a.onCountStop(),this.set("smsCounting",!1)},this.loadShow=function(){0==$("#ajax-loading").length&&$(".warper").append('<div class="ajax-loading" id="ajax-loading"><img src="/static_passport/images/ajax-loader.gif" alt=""></div>'),$("#ajax-loading").show()},this.loadHide=function(){$("#ajax-loading").hide()},this.canSend=function(){return!(this.get("smsTimesOver")||this.get("smsCounting"))},this.send=function(a){return c.Promise(function(b,c){this.loadShow(),$.getJSON(this.url,a,function(a){this.loadHide(),this.startCountDown(),0===a.errcode?(this.set("smsSent",!0),b(a)):(this.stopCountDown(),c(a))}.bind(this))}.bind(this))}}var c=a("library/q");return b});